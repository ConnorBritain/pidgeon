{
  "segment": "OBR",
  "name": "Observation Request",
  "description": "The OBR segment is used to transmit information about an exam, diagnostic study/observation, or assessment that is specific to an order or result. It serves as the report header and identifies the observation set represented by the following atomic observations.",
  "standard": "hl7v23",
  "version": "2.3",
  "usage": "R",
  "cardinality": {
    "min": 1,
    "max": 1,
    "note": "OBR segment is required and appears once per observation request in most message types"
  },
  "messageTypes": [
    "ORM^O01", "ORU^R01", "RDE^O01", "RDE^O11", "VXU^V04"
  ],
  "fields": {
    "OBR.1": {
      "name": "Set ID - OBR",
      "description": "This field contains the number that identifies this transaction. For the first occurrence of the segment, the sequence number shall be one; for the second occurrence, the sequence number shall be two; etc.",
      "dataType": "SI",
      "usage": "O",
      "maxLength": 4,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Sequential number starting from 1"
    },
    "OBR.2": {
      "name": "Placer Order Number",
      "description": "This field is identical to ORC-2-Placer Order Number. It is assigned by the placer (ordering application). This is a composite field containing an entity identifier and namespace ID.",
      "dataType": "EI",
      "usage": "C",
      "maxLength": 22,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: <entity_id>^<namespace_id>, e.g., 'ORD123456^LAB'"
    },
    "OBR.3": {
      "name": "Filler Order Number",
      "description": "This field is identical to ORC-3-Filler Order Number. It is assigned by the filler (receiving application). This is a composite field containing an entity identifier and namespace ID.",
      "dataType": "EI",
      "usage": "C",
      "maxLength": 22,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: <entity_id>^<namespace_id>, e.g., 'FIL789012^RAD'"
    },
    "OBR.4": {
      "name": "Universal Service ID",
      "description": "This field is the identifier code for the requested observation/test/battery. This can be based on local and/or universal codes. We recommend the universal procedure identifier.",
      "dataType": "CE",
      "usage": "R",
      "maxLength": 200,
      "cardinality": {
        "min": 1,
        "max": 1
      },
      "validValues": [
        {"code": "CBC", "description": "Complete Blood Count"},
        {"code": "BMP", "description": "Basic Metabolic Panel"},
        {"code": "CMP", "description": "Comprehensive Metabolic Panel"},
        {"code": "LIPID", "description": "Lipid Panel"},
        {"code": "TSH", "description": "Thyroid Stimulating Hormone"},
        {"code": "HBA1C", "description": "Hemoglobin A1C"},
        {"code": "UA", "description": "Urinalysis"},
        {"code": "PT", "description": "Prothrombin Time"},
        {"code": "PTT", "description": "Partial Thromboplastin Time"}
      ],
      "generationHint": "Most common lab tests include CBC, BMP, CMP, LIPID panels"
    },
    "OBR.5": {
      "name": "Priority",
      "description": "This field was used in earlier versions but is not supported in v2.3. Priority information should be carried in the ORC segment.",
      "dataType": "ID",
      "usage": "X",
      "maxLength": 2,
      "cardinality": {
        "min": 0,
        "max": 0
      },
      "generationHint": "Not used in v2.3 - leave empty"
    },
    "OBR.6": {
      "name": "Requested Date/Time",
      "description": "This field was used in earlier versions but is not supported in v2.3. Timing information should be carried in the ORC segment.",
      "dataType": "TS",
      "usage": "X",
      "maxLength": 26,
      "cardinality": {
        "min": 0,
        "max": 0
      },
      "generationHint": "Not used in v2.3 - leave empty"
    },
    "OBR.7": {
      "name": "Observation Date/Time",
      "description": "This field represents the clinically relevant date/time of the observation, usually the date/time the observation was performed or specimen collected.",
      "dataType": "TS",
      "usage": "C",
      "maxLength": 26,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: YYYYMMDDHHMMSS, e.g., '20241215143000' for Dec 15, 2024 2:30 PM"
    },
    "OBR.8": {
      "name": "Observation End Date/Time",
      "description": "This field contains the end date/time for the observation if the observation occurred over a period of time.",
      "dataType": "TS",
      "usage": "O",
      "maxLength": 26,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Usually empty for point-in-time observations"
    },
    "OBR.9": {
      "name": "Collection Volume",
      "description": "This field contains the volume of specimen collected for the observation. This is a composite quantity field.",
      "dataType": "CQ",
      "usage": "O",
      "maxLength": 20,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: <quantity>^<units>, e.g., '10^ML' or '5^CC'"
    },
    "OBR.10": {
      "name": "Collector Identifier",
      "description": "This field identifies the person who collected the specimen or performed the observation. Uses extended composite ID number and name format.",
      "dataType": "XCN",
      "usage": "O",
      "maxLength": 60,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: <id>^<last_name>^<first_name>^<degree>, e.g., '12345^SMITH^JOHN^MD'"
    },
    "OBR.11": {
      "name": "Specimen Action Code",
      "description": "This field indicates what action is to be taken with respect to the specimens that accompany or precede this order.",
      "dataType": "ID",
      "usage": "O",
      "maxLength": 1,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "validValues": [
        {"code": "A", "description": "Add ordered tests to the existing specimen"},
        {"code": "G", "description": "Generated order; reflex order"},
        {"code": "L", "description": "Lab to obtain specimen from patient"},
        {"code": "O", "description": "Specimen obtained by service other than Lab"},
        {"code": "P", "description": "Pending specimen; Order sent prior to delivery"},
        {"code": "R", "description": "Revised order"},
        {"code": "S", "description": "Schedule the tests specified below"}
      ],
      "generationHint": "Most common: L for lab collection, O for external collection"
    },
    "OBR.12": {
      "name": "Danger Code",
      "description": "This field identifies hazards and precautionary measures associated with collection and/or analysis of the specimen.",
      "dataType": "CE",
      "usage": "O",
      "maxLength": 60,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "validValues": [
        {"code": "BHZ", "description": "Biological hazard"},
        {"code": "COR", "description": "Corrosive"},
        {"code": "ESC", "description": "Escape risk"},
        {"code": "EXP", "description": "Explosive"},
        {"code": "IFL", "description": "Inflammable"},
        {"code": "INF", "description": "Infectious"},
        {"code": "INJ", "description": "Injection hazard"},
        {"code": "RAD", "description": "Radioactive"},
        {"code": "TOX", "description": "Toxic"}
      ],
      "generationHint": "Usually empty unless specific hazards exist"
    },
    "OBR.13": {
      "name": "Relevant Clinical Info",
      "description": "This field contains additional clinical information about the patient or specimen to provide context for laboratory interpretation.",
      "dataType": "ST",
      "usage": "O",
      "maxLength": 300,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Free text clinical context, e.g., 'Patient on anticoagulants', 'Fasting specimen'"
    },
    "OBR.14": {
      "name": "Specimen Received Date/Time",
      "description": "This field contains the date and time the specimen was received in the laboratory or other diagnostic service department.",
      "dataType": "TS",
      "usage": "C",
      "maxLength": 26,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: YYYYMMDDHHMMSS, typically after OBR.7 collection time"
    },
    "OBR.15": {
      "name": "Specimen Source",
      "description": "This field identifies the site from which the specimen was obtained. This is a complex field containing source, additives, and collection method.",
      "dataType": "CM",
      "usage": "O",
      "maxLength": 300,
      "cardinality": {
        "min": 0,
        "max": 1
      },
      "generationHint": "Format: <site>^<additive>^<collection_method>, e.g., 'Blood^EDTA^Venipuncture'"
    }
  },
  "crossReferences": {
    "fhir": [
      "DiagnosticReport.code",
      "ServiceRequest.code",
      "Specimen.collection"
    ],
    "related": ["ORC", "OBX", "NTE"]
  },
  "generationRules": {
    "required": ["OBR.4"],
    "conditional": {
      "OBR.2": "Required if placer order number exists",
      "OBR.3": "Required if filler order number exists",
      "OBR.7": "Required for completed observations",
      "OBR.14": "Required if specimen-based test"
    },
    "relationships": {
      "OBR.2_ORC.2": "Must match if both present",
      "OBR.3_ORC.3": "Must match if both present"
    }
  }
}