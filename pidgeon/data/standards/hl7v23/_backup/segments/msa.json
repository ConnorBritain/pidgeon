{
  "segment": "MSA",
  "name": "Message Acknowledgment",
  "description": "The Message Acknowledgment segment (MSA) contains information sent with an acknowledgment message. This segment is critical for reliable message processing, error handling, and system integration. It provides the receiving system's response to a message, including acceptance status, error information, and message control identifiers for proper message tracking and workflow management.",
  "standard": "hl7v23",
  "version": "2.3",
  "usage": "R",
  "cardinality": {
    "min": 1,
    "max": 1,
    "note": "MSA is required in all acknowledgment messages for system reliability"
  },
  "messageTypes": ["ACK^A01", "ACK^A04", "ACK^A08", "ACK^O01", "ACK^R01", "ACK^S12", "NAK"],
  "fields": {
    "MSA.1": {
      "name": "Acknowledgment Code",
      "description": "This field contains a code that indicates the acceptance or rejection status of the message.",
      "dataType": "ID",
      "usage": "R",
      "maxLength": 2,
      "cardinality": {"min": 1, "max": 1},
      "validValues": ["AA", "AE", "AR", "CA", "CE", "CR"],
      "generationHint": "AA=Application Accept, AE=Application Error, AR=Application Reject, CA=Commit Accept, CE=Commit Error, CR=Commit Reject",
      "example": "AA"
    },
    "MSA.2": {
      "name": "Message Control ID",
      "description": "This field contains the message control ID of the message being acknowledged.",
      "dataType": "ST",
      "usage": "R",
      "maxLength": 20,
      "cardinality": {"min": 1, "max": 1},
      "generationHint": "Must match the MSH.10 field from the original message being acknowledged",
      "example": "MSG20230315001"
    },
    "MSA.3": {
      "name": "Text Message",
      "description": "This field contains a textual description of the acknowledgment result or error condition.",
      "dataType": "ST",
      "usage": "O",
      "maxLength": 80,
      "cardinality": {"min": 0, "max": 1},
      "generationHint": "Human-readable description of processing result or error",
      "example": "Message processed successfully"
    },
    "MSA.4": {
      "name": "Expected Sequence Number",
      "description": "This field contains the sequence number expected in the next message from the sending system.",
      "dataType": "NM",
      "usage": "O",
      "maxLength": 15,
      "cardinality": {"min": 0, "max": 1},
      "generationHint": "Next expected sequence number for message ordering",
      "example": "1002"
    },
    "MSA.5": {
      "name": "Delayed Acknowledgment Type",
      "description": "This field indicates the type of delayed acknowledgment that will be sent.",
      "dataType": "ID",
      "usage": "O",
      "maxLength": 1,
      "cardinality": {"min": 0, "max": 1},
      "validValues": ["D", "F"],
      "generationHint": "D=Deferred, F=Final acknowledgment will follow",
      "example": "D"
    },
    "MSA.6": {
      "name": "Error Condition",
      "description": "This field contains a coded value indicating the specific error condition that occurred.",
      "dataType": "CE",
      "usage": "O",
      "maxLength": 250,
      "cardinality": {"min": 0, "max": 1},
      "validValues": ["100", "101", "102", "103", "200", "201", "202", "203", "204", "205", "206", "207"],
      "generationHint": "Standard HL7 error codes for specific error conditions",
      "example": "102^Data type error^HL70357"
    }
  },
  "vendorVariations": {
    "epic": {
      "commonFields": ["MSA.1", "MSA.2", "MSA.3"],
      "extensions": ["Enhanced error reporting", "Custom acknowledgment types", "Performance metrics"],
      "notes": "Epic provides detailed acknowledgment processing with performance tracking"
    },
    "cerner": {
      "commonFields": ["MSA.1", "MSA.2", "MSA.6"],
      "extensions": ["Automated retry logic", "Error categorization", "System health monitoring"],
      "notes": "Cerner emphasizes automated error handling and system monitoring"
    },
    "allscripts": {
      "commonFields": ["MSA.1", "MSA.2", "MSA.3", "MSA.4"],
      "extensions": ["Sequence tracking", "Message routing", "Delivery confirmation"],
      "notes": "Allscripts focuses on reliable message delivery and sequence management"
    },
    "interfaceware": {
      "commonFields": ["MSA.1", "MSA.2", "MSA.3", "MSA.6"],
      "extensions": ["Integration engine features", "Message transformation tracking", "Workflow monitoring"],
      "notes": "Interface engines provide comprehensive message processing acknowledgments"
    }
  },
  "crossReferences": {
    "fhir": [
      "MessageHeader.response.identifier",
      "MessageHeader.response.code",
      "MessageHeader.response.details",
      "OperationOutcome.issue.severity",
      "OperationOutcome.issue.code",
      "OperationOutcome.issue.details",
      "OperationOutcome.issue.diagnostics"
    ],
    "related": [
      "MSH (Message Header)",
      "ERR (Error)",
      "NTE (Notes and Comments)",
      "QAK (Query Acknowledgment)",
      "QPD (Query Parameter Definition)"
    ]
  },
  "examples": [
    {
      "name": "Successful Message Acknowledgment",
      "segment": "MSA|AA|MSG20230315001|Message processed successfully|1002||",
      "description": "Standard successful acknowledgment with next expected sequence number"
    },
    {
      "name": "Application Error Acknowledgment",
      "segment": "MSA|AE|MSG20230315002|Patient ID not found in system||102^Data type error^HL70357",
      "description": "Application error with specific error condition code"
    },
    {
      "name": "Application Reject Acknowledgment",
      "segment": "MSA|AR|MSG20230315003|Message format invalid - missing required fields|||200^Unsupported message type^HL70357",
      "description": "Message rejection due to format or content issues"
    },
    {
      "name": "Commit Accept with Delayed Processing",
      "segment": "MSA|CA|MSG20230315004|Message queued for batch processing|1003|D|",
      "description": "Commit accept indicating message will be processed later"
    },
    {
      "name": "Commit Error Acknowledgment",
      "segment": "MSA|CE|MSG20230315005|Database connection failed during processing|||207^Application internal error^HL70357",
      "description": "Commit error indicating system-level processing failure"
    }
  ],
  "notes": [
    "MSA segments are mandatory in all acknowledgment messages for reliable messaging",
    "The acknowledgment code determines whether further processing or retransmission is needed",
    "Message control IDs must exactly match the original message for proper tracking",
    "Error conditions provide specific feedback for troubleshooting and system monitoring",
    "Delayed acknowledgment types support asynchronous processing workflows",
    "Text messages should be human-readable for operational support and debugging",
    "Multiple MSA segments are not permitted - each acknowledgment message contains exactly one"
  ],
  "generationRules": {
    "fieldPopulation": {
      "required": ["MSA.1", "MSA.2"],
      "recommended": ["MSA.3"],
      "situational": ["MSA.4", "MSA.5", "MSA.6"]
    },
    "dataConsistency": {
      "controlIdMatching": "MSA.2 must exactly match MSH.10 from original message",
      "acknowledgmentCoherence": "MSA.1 must align with MSA.3 and MSA.6 content",
      "sequenceLogic": "MSA.4 should increment from last processed message sequence",
      "errorAlignment": "MSA.6 should only be present when MSA.1 indicates error or reject"
    },
    "businessRules": {
      "reliableMessaging": "Every message requires appropriate acknowledgment response",
      "errorReporting": "Error conditions must provide actionable information",
      "sequenceManagement": "Sequence numbers support ordered message processing",
      "timelyResponse": "Acknowledgments should be sent promptly for system efficiency"
    },
    "messageFlow": {
      "triggers": ["Message receipt", "Message processing completion", "Error detection"],
      "responses": ["Sending system action", "Retry logic", "Error escalation"],
      "workflow": "Critical component of reliable HL7 message exchange patterns"
    },
    "acknowledgmentTypes": {
      "AA": "Successful processing, no further action needed",
      "AE": "Application error, sender should review and potentially resend",
      "AR": "Application reject, sender should not retry without corrections",
      "CA": "Commit accept, message received and queued for processing",
      "CE": "Commit error, temporary system issue, sender may retry",
      "CR": "Commit reject, permanent issue, sender should not retry"
    }
  }
}
